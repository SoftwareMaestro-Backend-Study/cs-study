# Overview

`spring AOP`ì—ì„œëŠ” ì¸í„°í˜ì´ìŠ¤ ìœ ë¬´ì— ë”°ë¼ ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ì˜ í”„ë¡ì‹œ ìƒì„± ì‹œÂ `Dynamic Proxy`ë¥¼ ì‚¬ìš©í•˜ê³  ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ì´ ì•„ë‹ ì‹œÂ `CGLib`ì„ ì‚¬ìš©í•˜ëŠ”ë°

`spring boot AOP`ì—ì„œëŠ”Â `CGLib`ì„ defaultë¡œ ì‚¬ìš©í•œë‹¤ê³  í•œë‹¤.

### **JDK Dynamic Proxy**

JDK ì—ì„œ ì œê³µí•˜ëŠ” Dynamic ProxyëŠ”Â **Interfaceë¥¼ ê¸°ë°˜ìœ¼ë¡œ Proxyë¥¼ ìƒì„±**í•´ì£¼ëŠ” ë°©ì‹ì´ë‹¤.

Interfaceë¥¼ ê¸°ë°˜ìœ¼ë¡œ Proxyë¥¼ ìƒì„±í•´ì£¼ê¸° ë•Œë¬¸ì— ì¸í„°í˜ì´ìŠ¤ì˜ ì¡´ì¬ê°€ í•„ìˆ˜ì ì´ë‹¤.

ìë°”ì—ì„œëŠ” ë¦¬í”Œë ‰ì…˜ì„ í™œìš©í•œ Proxy í´ë˜ìŠ¤ë¥¼ ì œê³µí•´ì£¼ê³  ìˆë‹¤.

`Java.lang.reflect.Proxy`Â í´ë˜ìŠ¤ì˜Â `newProxyInstance()`Â ë©”ì†Œë“œë¥¼ ì´ìš©í•´ í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.

<details>
<summary>ì‹¤ìŠµ</summary>
- ì‹¤ìŠµ
    
    ## ë‹¤ì´ë‚˜ë¯¹ í”„ë¡ì‹œ ì‹¤ìŠµí•´ë³´ê¸°
    
    ### 1. ì¸í„°í˜ì´ìŠ¤ ì‘ì„±
    
    ë‹¤ì´ë‚˜ë¯¹ í”„ë¡ì‹œëŠ” ì¸í„°í˜ì´ìŠ¤ ì¡´ì¬ê°€ í•„ìˆ˜ì ì´ë¯€ë¡œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‘ì„±í•œë‹¤.
    
    ```java
    public interface Animal {
        void eat();
        void drink();
    }
    ```
    
    ### 2. ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„
    
    ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†ë°›ì•„ íƒ€ì¼“ì„ êµ¬í˜„í•œë‹¤.
    
    `eat()`ë©”ì„œë“œì™€Â `drink()`ë©”ì„œë“œë¥¼ ì •ì˜í•˜ê³  ë©”ì„œë“œ í˜¸ì¶œ ì‹œÂ `Dynamic Proxy`ë¥¼ ì´ìš©í•´ ì• ë’¤ë¡œ ë¡œê·¸ë¥¼ weaving í•´ë³´ë ¤ê³  í•œë‹¤.
    
    ```java
    public class Rabbit implements Animal{
        @Override
        public void eat() {
            System.out.println("í† ë¼ê°€ ìŒì‹ì„ ë¨¹ìŠµë‹ˆë‹¤.");
        }
    
        @Override
        public void drink() {
            System.out.println("í† ë¼ê°€ ë¬¼ì„ ë§ˆì‹­ë‹ˆë‹¤.");
        }
    }
    ```
    
    ```java
    public class Tiger implements Animal{
        @Override
        public void eat() {
            System.out.println("í˜¸ë‘ì´ê°€ ìŒì‹ì„ ë¨¹ìŠµë‹ˆë‹¤.");
        }
    
        @Override
        public void drink() {
            System.out.println("í˜¸ë‘ì´ê°€ ë¬¼ì„ ë§ˆì‹­ë‹ˆë‹¤.");
        }
    }
    ```
    
    ### 3. í”„ë¡ì‹œ í•¸ë“¤ëŸ¬ êµ¬í˜„
    
    í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±í•  ë•Œ í•„ìš”í•œ í•¸ë“¤ëŸ¬ë¥¼ êµ¬í˜„í•œë‹¤.Â `InvocationHandler`ë¥¼ ìƒì†ë°›ì•„ êµ¬í˜„í•œë‹¤. ë©”ì„œë“œ í˜¸ì¶œ ì „ í›„ì— ë¡œê·¸ë¥¼ ì°ì–´ë³´ê² ë‹¤.
    
    ```java
    import java.lang.reflect.InvocationHandler;
    import java.lang.reflect.Method;
    
    public class AnimalProxyHandler implements InvocationHandler {
    
        Object target;
    
        public AnimalProxyHandler(Object target) {
            this.target = target;
        }
    
        @Override
        public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
            Object result = null;
            System.out.println("****before****");
    
            //ë©”ì„œë“œê°€ eat ì´ë¼ë©´
            if(method.getName().equals("eat")) {
                System.out.println("----eat ë©”ì„œë“œ í˜¸ì¶œ ì „----");
    
                result = method.invoke(target, args); // ë©”ì„œë“œ í˜¸ì¶œ
    
                System.out.println("----eat ë©”ì„œë“œ í˜¸ì¶œ í›„----");
            } else if(method.getName().equals("drink")) { // ë©”ì„œë“œê°€ drink ë¼ë©´
                System.out.println("----drink ë©”ì„œë“œ í˜¸ì¶œ ì „----");
    
                result = method.invoke(target, args); // ë©”ì„œë“œ í˜¸ì¶œ
    
                System.out.println("----drink ë©”ì„œë“œ í˜¸ì¶œ í›„----");
            }
    
            System.out.println("****after****");
            return result; // í˜¸ì¶œê²°ê³¼ ë°˜í™˜
        }
    }
    ```
    
    ### 4. ì˜ˆì œ í…ŒìŠ¤íŠ¸ì½”ë“œ ì‘ì„±
    
    í•¸ë“¤ëŸ¬ë„ êµ¬í˜„í•˜ì˜€ìœ¼ë‹ˆ í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±í•´ë³´ê² ë‹¤.
    
    `Java.lang.reflect.Proxy`Â í´ë˜ìŠ¤ì˜Â `newProxyInstance()`Â ë©”ì†Œë“œë¥¼ ì´ìš©í•œë‹¤.
    
    ```java
    import org.junit.Test;
    
    import java.lang.reflect.Proxy;
    
    public class DynamicProxyTests {
        @Test
        public void dynamicProxyExample() {
            // Create the proxy
            //ë™ì ìœ¼ë¡œ í”„ë¡ì‹œ ìƒì„±
            // rabbit
            Animal rabbit = (Animal) Proxy.newProxyInstance(Animal.class.getClassLoader(),
                    new Class[]{Animal.class},
                    new AnimalProxyHandler(new Rabbit()));
            // tiger
            Animal tiger = (Animal) Proxy.newProxyInstance(Animal.class.getClassLoader(),
                    new Class[]{Animal.class},
                    new AnimalProxyHandler(new Tiger()));
    
            // Invoke the target instance method through the proxy
            rabbit.eat();
            System.out.println();
            rabbit.drink();
            System.out.println();
    
            tiger.eat();
            System.out.println();
            tiger.drink();
            System.out.println();
        }
    }
    ```
    
    ### 5. ì‹¤í–‰ ê²°ê³¼
    
    ì˜¤ì˜¤ì˜¤,, ëŠë‚Œì´Â `spring AOP`ì™€ êµ‰ì¥íˆ ë¹„ìŠ·í•˜ë‹¤.
    
    ```bash
    /Users/suhongkim/Library/Java/JavaVirtualMachines/openjdk-15.0.2/...
    
    ****before****
    ----eat ë©”ì„œë“œ í˜¸ì¶œ ì „----
    í† ë¼ê°€ ìŒì‹ì„ ë¨¹ìŠµë‹ˆë‹¤.
    ----eat ë©”ì„œë“œ í˜¸ì¶œ í›„----
    ****after****
    
    ****before****
    ----drink ë©”ì„œë“œ í˜¸ì¶œ ì „----
    í† ë¼ê°€ ë¬¼ì„ ë§ˆì‹­ë‹ˆë‹¤.
    ----drink ë©”ì„œë“œ í˜¸ì¶œ í›„----
    ****after****
    
    ****before****
    ----eat ë©”ì„œë“œ í˜¸ì¶œ ì „----
    í˜¸ë‘ì´ê°€ ìŒì‹ì„ ë¨¹ìŠµë‹ˆë‹¤.
    ----eat ë©”ì„œë“œ í˜¸ì¶œ í›„----
    ****after****
    
    ****before****
    ----drink ë©”ì„œë“œ í˜¸ì¶œ ì „----
    í˜¸ë‘ì´ê°€ ë¬¼ì„ ë§ˆì‹­ë‹ˆë‹¤.
    ----drink ë©”ì„œë“œ í˜¸ì¶œ í›„----
    ****after****
    
    Process finished with exit code 0
    ```
    
    ë‹¤ì´ë‚˜ë¯¹ í”„ë¡ì‹œëŠ” ì¸í„°í˜ì´ìŠ¤ê°€ í•„ìˆ˜ì´ë‹¤. ì¸í„°í˜ì´ìŠ¤ ì—†ì„ ë•Œë„ í”„ë¡ì‹œ íŒ¨í„´ì„ ì‚¬ìš©í•˜ê³  ì‹¶ì§€ ì•Šì„ê¹Œ,Â `CGLib`ê°€ ì´ ë¬¸ì œë¥¼ í•´ê²°í•´ì¤€ë‹¤.
</details>
    
- **ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜**: JDK Dynamic ProxyëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•œë‹¤. ë”°ë¼ì„œ í”„ë¡ì‹œë¥¼ ìƒì„±í•˜ë ¤ëŠ” ëŒ€ìƒ ê°ì²´ëŠ” ë°˜ë“œì‹œ í•˜ë‚˜ ì´ìƒì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.
- **ì‚¬ìš© ë°©ë²•**: **`InvocationHandler`** ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” ê°ì²´ë¥¼ ì œê³µí•˜ì—¬ í”„ë¡ì‹œ ê°ì²´ì˜ ëª¨ë“  ë©”ì„œë“œ í˜¸ì¶œì„ í•¸ë“¤ë§í•œë‹¤.
- **ì¥ì **: ì¶”ê°€ì ì¸ ì˜ì¡´ì„± ì—†ì´ JDKì— í¬í•¨ë˜ì–´ ìˆì–´ ì‚¬ìš©ì´ ê°„ë‹¨í•˜ë‹¤.
- **ë‹¨ì **: ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ì§€ ì•Šì€ í´ë˜ìŠ¤ì— ëŒ€í•´ í”„ë¡ì‹œë¥¼ ìƒì„±í•  ìˆ˜ ì—†ë‹¤.

### **CGLib**

CGLibëŠ” JDK Dynamic Proxyì™€ëŠ” ë‹¤ë¥´ê²Œ ì¸í„°í˜ì´ìŠ¤ê°€ ì•„ë‹ŒÂ **í´ë˜ìŠ¤ ê¸°ë°˜ìœ¼ë¡œ ë°”ì´íŠ¸ì½”ë“œë¥¼ ì¡°ì‘í•˜ì—¬ í”„ë¡ì‹œë¥¼ ìƒì„±**í•˜ëŠ” ë°©ì‹ì´ë‹¤.

`CGLib`ì€ ë°”ì´íŠ¸ì½”ë“œ ì¡°ì‘ì„ ìœ„í•´Â **ASM**ì´ë¼ëŠ” ìë°” ë°”ì´íŠ¸ì½”ë“œ ì¡°ì‘ ë° ë¶„ì„ í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•œë‹¤. ASMì„ í†µí•´ í´ë˜ìŠ¤ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ê±°ë‚˜ ìˆ˜ì •í•œë‹¤.

ì¸í„°í˜ì´ìŠ¤ê°€ ì•„ë‹Œ í´ë˜ìŠ¤ë¥¼ ëŒ€ìƒìœ¼ë¡œ ë™ì‘ ê°€ëŠ¥í•˜ê³  ë°”ì´íŠ¸ì½”ë“œë¥¼ ì¡°ì‘í•´ í”„ë¡ì‹œë¥¼ ë§Œë“¤ê¸° ë•Œë¬¸ì— Dynamic Proxyì— ë¹„í•´ ì„±ëŠ¥ì´ ìš°ìˆ˜í•˜ë‹¤ëŠ” ì¥ì ì´ ìˆì§€ë§Œ

Extends(ìƒì†) ë°©ì‹ì„ ì´ìš©í•´ì„œ Proxyí™” í•  ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë”©í•˜ëŠ” ë°©ì‹ì¸ë§Œí¼Â `final`ì´ë‚˜Â `private`ì™€ ê°™ì´ ìƒì†ëœ ê°ì²´ì— ì˜¤ë²„ë¼ì´ë”©ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ê²½ìš° Proxyì—ì„œ í•´ë‹¹ ë©”ì†Œë“œì— ëŒ€í•œ Aspectë¥¼ ì ìš©í•  ìˆ˜ ì—†ë‹¤.

<details>
<summary>ì‹¤ìŠµ</summary>
- ì‹¤ìŠµ
    
    ## CGLib ì‹¤ìŠµí•´ë³´ê¸°
    
    ### 1. CGLib ì˜ì¡´ì„± ì¶”ê°€
    
    springì—ì„œëŠ” spring AOPë¥¼ ìœ„í•´ spring core íŒ¨í‚¤ì§€ì— CGLibê°€ ê¸°ë³¸ì ìœ¼ë¡œ í¬í•¨ë˜ì–´ ìˆë‹¤. ìŠ¤í”„ë§ í™˜ê²½ì´ ì•„ë‹Œ ìë°”ì—ì„œ CGLibì„ ì‚¬ìš©í•˜ê³ ì í•˜ë‹ˆ ì˜ì¡´ì„±ì„ ì¶”ê°€í•´ì£¼ê² ë‹¤.
    
    ```xml
    <!-- https://mvnrepository.com/artifact/cglib/cglib -->
    <dependency><groupId>cglib</groupId><artifactId>cglib</artifactId><version>3.3.0</version></dependency>
    ```
    
    ### 2. í´ë˜ìŠ¤ ì‘ì„±
    
    ë‹¤ì´ë‚˜ë¯¹ í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•  ë• ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ì´ í•„ìˆ˜ì˜€ì§€ë§Œ CGLibì€ ê·¸ë ‡ì§€ ì•Šë‹¤. í´ë˜ìŠ¤ë§Œ ì‘ì„±í•´ì¤€ë‹¤.
    
    ```java
    public class Rabbit {
        public void eat() {
            System.out.println("í† ë¼ê°€ ìŒì‹ì„ ë¨¹ìŠµë‹ˆë‹¤.");
        }
    
        public void drink() {
            System.out.println("í† ë¼ê°€ ë¬¼ì„ ë§ˆì‹­ë‹ˆë‹¤.");
        }
    }
    ```
    
    ### 3. í”„ë¡ì‹œ í•¸ë“¤ëŸ¬ êµ¬í˜„
    
    !https://velog.velcdn.com/images%2Fsuhongkim98%2Fpost%2Fe99b4fdf-6451-43d5-ba8f-a79082d01be3%2Fimage.png
    
    CGLibë¥¼ ì‚¬ìš©í•˜ì—¬ í”„ë¡ì‹œë¥¼ ìƒì„±í•  ë•Œì—ëŠ” í¬ê²Œ í¬ê²Œ ë‘ê°€ì§€ ì‘ì—…ì„ í•„ìš”ë¡œ í•œë‹¤.
    
    - `net.sf.cglib.proxy.Enhancer`Â í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì›í•˜ëŠ” í”„ë¡ì‹œ ê°ì²´ ë§Œë“¤ê¸°
    - `net.sf.cglib.proxy.Callback`ì„ ì‚¬ìš©í•˜ì—¬ í”„ë¡ì‹œ ê°ì²´ ì¡°ì‘í•˜ê¸°
    
    í”„ë¡ì‹œ ê°ì²´ë¥¼ ì¡°ì‘í•˜ê¸° ìœ„í•´Â `MethodInterceptor`Â ë°©ì‹ê³¼ ë‹¤ì´ë‚˜ë¯¹ í”„ë¡ì‹œì—ì„œ ì‚¬ìš©í–ˆë˜Â `InvocationHandler`Â ë°©ì‹ì„ ì‚¬ìš©í•´ í•¸ë“¤ëŸ¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
    
    `InvocationHandler`Â ë°©ì‹ì„ ì‚¬ìš©í•  ê²½ìš° ë°”ì´íŠ¸ì½”ë“œ ì¡°ì‘ì´ ì•„ë‹ˆë¼ ë‹¤ì´ë‚˜ë¯¹ í”„ë¡ì‹œì™€ ë§ˆì°¬ê°€ì§€ë¡œ ë¦¬í”Œë ‰ì…˜ì„ í™œìš©í•œë‹¤. CGLibì˜ ì„±ëŠ¥ì„ í™œìš©í•˜ê¸° ìœ„í•´ì„œëŠ”Â `MethodInterceptor`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ì´ë‹¤.
    
    ë¨¼ì € ë‹¤ì´ë‚˜ë¯¹ í”„ë¡ì‹œì—ì„œ ì‚¬ìš©í–ˆë˜Â `InvocationHandler`ë¥¼ ì¬ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ë³´ì—¬ì£¼ê¸° ìœ„í•´Â `InvocationHandler`Â ë°©ì‹ì„ ë¨¼ì € í™•ì¸í•´ë³´ì
    
    ### 3-1 InvocationHandler ë°©ì‹ìœ¼ë¡œ í•¸ë“¤ëŸ¬ êµ¬í˜„
    
    ëª¨ë“  ì½”ë“œëŠ” í•œ ì¤„ë§Œ ë¹¼ê³  ìœ„ì˜ ë‹¤ì´ë‚˜ë¯¹ í”„ë¡ì‹œì—ì„œ ì‚¬ìš©í–ˆë˜Â `InvocationHandler`ì½”ë“œì™€ ì¼ì¹˜í•˜ë‹¤.
    
    import ì‹œÂ `java.lang.reflect.InvocationHandler`Â ë¥¼Â `net.sf.cglib.proxy.InvocationHandler`ë¡œÂ `InvocationHandler`Â ê²½ë¡œë§Œ ë°”ê¿”ì£¼ë©´ ëœë‹¤.
    
    ```java
    import net.sf.cglib.proxy.InvocationHandler;
    
    import java.lang.reflect.Method;
    
    //CGLib ì—ì„œ Dynamic Proxy ì—ì„œ ì‚¬ìš©í–ˆë˜ í•¸ë“¤ëŸ¬ ë°©ì‹ ì‚¬ìš©í•˜ê¸°
    // ì´ëŠ” ìë°” ë¦¬í”Œë ‰ì…˜ì„ ì‚¬ìš©í•œë‹¤.
    public class AnimalProxyCGLibHandler implements InvocationHandler {
    
        Object target;
    
        public AnimalProxyCGLibHandler(Object target) {
            this.target = target;
        }
    
        @Override
        public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
            Object result = null;
            System.out.println("****before****");
    
            //ë©”ì„œë“œê°€ eat ì´ë¼ë©´
            if(method.getName().equals("eat")) {
                System.out.println("----eat ë©”ì„œë“œ í˜¸ì¶œ ì „----");
    
                result = method.invoke(target, args); // ë©”ì„œë“œ í˜¸ì¶œ //ìë°”ì˜ ë¦¬í”Œë ‰ì…˜ ì‚¬ìš©
    
                System.out.println("----eat ë©”ì„œë“œ í˜¸ì¶œ í›„----");
            } else if(method.getName().equals("drink")) { // ë©”ì„œë“œê°€ drink ë¼ë©´
                System.out.println("----drink ë©”ì„œë“œ í˜¸ì¶œ ì „----");
    
                result = method.invoke(target, args); // ë©”ì„œë“œ í˜¸ì¶œ
    
                System.out.println("----drink ë©”ì„œë“œ í˜¸ì¶œ í›„----");
            }
    
            System.out.println("****after****");
            return result; // í˜¸ì¶œê²°ê³¼ ë°˜í™˜
        }
    }
    ```
    
    ### 3-1 InvocationHandler ë°©ì‹ í”„ë¡ì‹œ ê°ì²´ ìƒì„± ì˜ˆì œ ì½”ë“œ
    
    `Enhancer`ë¥¼ ì´ìš©í•´ í”„ë¡ì‹œë¥¼ ìƒì„±í•œë‹¤.
    
    `setCallback`ë¥¼ ì´ìš©í•´ í•¸ë“¤ëŸ¬ë¥¼ ì ìš©í•œë‹¤.
    
    ```java
    //CGLib ì—ì„œ Dynamic Proxy ì—ì„œ ì‚¬ìš©í–ˆë˜ í•¸ë“¤ëŸ¬ ë°©ì‹ ì‚¬ìš©í•˜ê¸°
        // ì´ëŠ” ìë°” ë¦¬í”Œë ‰ì…˜ì„ ì‚¬ìš©í•œë‹¤.
        @Test
        public void byHandlerExample() {
            //Enhancer ê°ì²´ë¥¼ ìƒì„±
            Enhancer rabbitEnhancer = new Enhancer();
            // setSuperclass() ë©”ì†Œë“œì— í”„ë¡ì‹œí•  í´ë˜ìŠ¤ ì§€ì •
            rabbitEnhancer.setSuperclass(Rabbit.class);
            rabbitEnhancer.setCallback(new AnimalProxyCGLibHandler(new Rabbit())); // í•¸ë“¤ëŸ¬ ì§€ì •
            Rabbit rabbit = (Rabbit) rabbitEnhancer.create(); // í”„ë¡ì‹œ ìƒì„±
    
            rabbit.eat();
            System.out.println();
            rabbit.drink();
        }
    ```
    
    ### 3-1 InvocationHandler ì˜ˆì œ ì‹¤í–‰ ê²°ê³¼
    
    ë‹¤ì´ë‚˜ë¯¹ í”„ë¡ì‹œì™€ ê²°ê³¼ê°€ ë™ì¼í•˜ë‹¤.
    
    ```bash
    /Users/suhongkim/Library/Java/JavaVirtualMachines/openjdk-15.0.2/...
    
    ****before****
    ----eat ë©”ì„œë“œ í˜¸ì¶œ ì „----
    í† ë¼ê°€ ìŒì‹ì„ ë¨¹ìŠµë‹ˆë‹¤.
    ----eat ë©”ì„œë“œ í˜¸ì¶œ í›„----
    ****after****
    
    ****before****
    ----drink ë©”ì„œë“œ í˜¸ì¶œ ì „----
    í† ë¼ê°€ ë¬¼ì„ ë§ˆì‹­ë‹ˆë‹¤.
    ----drink ë©”ì„œë“œ í˜¸ì¶œ í›„----
    ****after****
    
    Process finished with exit code 0
    ```
    
    ### 3-2 MethodInterceptor ë°©ì‹ìœ¼ë¡œ í•¸ë“¤ëŸ¬ êµ¬í˜„
    
    `MethodInterceptor`ë¥¼ ìƒì†ë°›ì•„ ì• ë’¤ë¡œ ë¡œê·¸ ì¶œë ¥ì„ í•´ì£¼ëŠ” ì¸í„°ì…‰í„°ë¥¼ êµ¬í˜„í•´ë³´ê² ë‹¤.
    
    ```java
    public class PrintLogInterceptor implements MethodInterceptor {
        @Override
        public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable {
            Object result = null;
            System.out.println("****before log****");
            result = methodProxy.invokeSuper(o, objects);
            System.out.println("****after log****");
            return result;
        }
    }
    ```
    
    ### 3-2 MethodInterceptor ì˜ˆì œ í…ŒìŠ¤íŠ¸ì½”ë“œ ì‘ì„±
    
    ```java
    @Test
        public void byInterceptorExample() {
            //Enhancer ê°ì²´ë¥¼ ìƒì„±
            Enhancer rabbitEnhancer = new Enhancer();
            // setSuperclass() ë©”ì†Œë“œì— í”„ë¡ì‹œí•  í´ë˜ìŠ¤ ì§€ì •
            rabbitEnhancer.setSuperclass(Rabbit.class);
            // ë¡œê·¸ ì¶œë ¥í•´ì£¼ëŠ” ì¸í„°ì…‰í„° ì§€ì •
            rabbitEnhancer.setCallback(new PrintLogInterceptor());
            Rabbit rabbit = (Rabbit) rabbitEnhancer.create(); // í”„ë¡ì‹œ ìƒì„±
    
            rabbit.eat();
            System.out.println();
            rabbit.drink();
        }
    ```
    
    ### 3-2 ì¸í„°ì…‰í„° ì˜ˆì œ ì‹¤í–‰ ê²°ê³¼
    
    ```bash
    /Users/suhongkim/Library/Java/JavaVirtualMachines/openjdk-15.0.2/...
    
    ****before log****
    í† ë¼ê°€ ìŒì‹ì„ ë¨¹ìŠµë‹ˆë‹¤.
    ****after log****
    
    ****before log****
    í† ë¼ê°€ ë¬¼ì„ ë§ˆì‹­ë‹ˆë‹¤.
    ****after log****
    
    Process finished with exit code 0
    ```
    
    ## CGLibì˜ Callback Filter
    
    ì§€ê¸ˆê¹Œì§€ëŠ”Â `setCallback()`Â ë©”ì„œë“œë¥¼ ì´ìš©í•´ ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•˜ì˜€ë‹¤.
    
    í•­ìƒ ê°™ì€ ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•´ì•¼í•˜ë‚˜? í•„í„° ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¥¸ ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•˜ê³  ì‹¶ì§€ ì•Šì„ê¹Œ? Callback Filterì„ êµ¬í˜„í•¨ìœ¼ë¡œì¨ í•´ê²° ê°€ëŠ¥í•˜ë‹¤.
    
    CallbackFilterë¥¼ êµ¬í˜„í•  ë•ŒÂ `accept()`Â ë©”ì„œë“œë¥¼ ì¬ì •ì˜í•œë‹¤.
    
    `accept()`Â ë©”ì„œë“œëŠ” intí˜•ì˜ indexê°’ì„ ë°˜í™˜í•˜ëŠ”ë° ì´ ì¸ë±ìŠ¤ë¥¼ ì´ìš©í•´ callback ë°°ì—´ì— ìˆëŠ” ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•œë‹¤.
    
    ### 1. CallbackFilter êµ¬í˜„
    
    ë©”ì„œë“œ ì´ë¦„ì— ë”°ë¼ ë‹¤ë¥¸ ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•´ë³´ë ¤ê³  í•œë‹¤.
    
    ë‚˜ëŠ” í˜¸ì¶œí•˜ê³ ì í•˜ëŠ” ë©”ì„œë“œê°€Â `eat()`ì¸ ê²½ìš°Â `EatInterceptor`ë¥¼ ì ìš©í•˜ê³ ì 0ì„ ë°˜í™˜í•˜ê³  ë©”ì„œë“œê°€Â `drink()`ì¸ ê²½ìš°Â `EatInterceptor`ë¥¼ ì ìš©í•˜ê³ ì 1ì„ ë°˜í™˜í•˜ë„ë¡ í–ˆë‹¤.
    
    ```java
    // ë©”ì„œë“œê°€ eat ì´ëƒ drink ëƒì— ë”°ë¼ í•´ë‹¹í•˜ëŠ” ì¸ë±ìŠ¤ ë°˜í™˜í•´ì£¼ëŠ” í•„í„°
    public class AnimalMethodCallbackFilter implements CallbackFilter {
        @Override
        public int accept(Method method) {
            if(method.getName().equals("eat")) return 0;
            if(method.getName().equals("drink")) return 1;
            return 0; // í•´ë‹¹í•˜ì§€ ì•Šìœ¼ë©´ ê·¸ëƒ¥ 0ë°˜í™˜
        }
    }
    ```
    
    ### 2. ì ìš©í•˜ê³ ì í•˜ëŠ” ì¸í„°ì…‰í„°ë“¤ êµ¬í˜„
    
    ì¸í„°ì…‰í„° êµ¬í˜„ ë°©ë²•ì€ ìŠ¤í¬ë¡¤ì„ ì˜¬ë ¤ ì˜ˆì œë¥¼ ì°¸ê³ í•˜ì.
    
    ### 3. callback filter ì˜ˆì œ í…ŒìŠ¤íŠ¸ì½”ë“œ ì‘ì„±
    
    `setCallbackFilter()`ë©”ì„œë“œë¥¼ í†µí•´ êµ¬í˜„í–ˆë˜ callback í•„í„°ë¥¼ ì ìš©í•œë‹¤.
    
    `setCallbacks()`Â ë©”ì„œë“œë¥¼ í†µí•´ ì¸í„°ì…‰í„° ë°°ì—´ì„ ì ìš©í•œë‹¤.
    
    ê·¸ëŸ¼ ë©”ì„œë“œ í˜¸ì¶œí•  ë•Œë§ˆë‹¤ ë©”ì„œë“œ ì´ë¦„ì— ë”°ë¼ ë°˜í™˜í•˜ëŠ” ì¸ë±ìŠ¤ê°’ì„ ì´ìš©í•´ í•´ë‹¹í•˜ëŠ” ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•´ì¤„ ê²ƒì´ë‹¤.
    
    ```java
    @Test
        public void callbackFilterExample() {
            //ì½œë°± í•„í„°ë¥¼ ì´ìš©í•´ í•„í„° ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¥¸ ì¸í„°ì…‰í„° ì ìš©í•˜ê¸° ì˜ˆì œ
            //ë©”ì„œë“œê°€ ë¬´ì—‡ì´ëƒì— ë”°ë¼ í•´ë‹¹ ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•œë‹¤.
            //Enhancer ê°ì²´ë¥¼ ìƒì„±
            Enhancer rabbitEnhancer = new Enhancer();
            // setSuperclass() ë©”ì†Œë“œì— í”„ë¡ì‹œí•  í´ë˜ìŠ¤ ì§€ì •
            rabbitEnhancer.setSuperclass(Rabbit.class);
            //ë©”ì„œë“œ ì´ë¦„ì— ë”°ë¼ ì¸ë±ìŠ¤ ë°˜í™˜í•´ì£¼ëŠ” ì½œë°± í•„í„° ì§€ì •, 0 ë°˜í™˜ ì‹œ EatInterceptor, 1 ë°˜í™˜ ì‹œ DrinkInterceptor
            rabbitEnhancer.setCallbackFilter(new AnimalMethodCallbackFilter());
            // ì½œë°± ë°°ì—´ ì§€ì •
            rabbitEnhancer.setCallbacks(new Callback[]{
                    new EatInterceptor(), // 0
                    new DrinkInterceptor() // 1
            });
            Rabbit rabbit = (Rabbit) rabbitEnhancer.create(); // í”„ë¡ì‹œ ìƒì„±
    
            rabbit.eat();
            System.out.println();
            rabbit.drink();
        }
    ```
    
    ### 4. callback filter ì ìš© ì˜ˆì œ ì‹¤í–‰ ê²°ê³¼
    
    ```bash
    /Users/suhongkim/Library/Java/JavaVirtualMachines/openjdk-15.0.2/...
    
    -- eat ë©”ì„œë“œ í˜¸ì¶œ ì „ --
    í† ë¼ê°€ ìŒì‹ì„ ë¨¹ìŠµë‹ˆë‹¤.
    -- eat ë©”ì„œë“œ í˜¸ì¶œ í›„ --
    
    -- drink ë©”ì„œë“œ í˜¸ì¶œ ì „ --
    í† ë¼ê°€ ë¬¼ì„ ë§ˆì‹­ë‹ˆë‹¤.
    -- drink ë©”ì„œë“œ í˜¸ì¶œ í›„ --
    
    Process finished with exit code 0
    
    ```
</details>
    
- **í´ë˜ìŠ¤ ê¸°ë°˜**: CGLibëŠ” í´ë˜ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•œë‹¤. ë”°ë¼ì„œ ì¸í„°í˜ì´ìŠ¤ ì—†ì´ë„ í”„ë¡ì‹œë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.
- **ì‚¬ìš© ë°©ë²•**: **`MethodInterceptor`** ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ì—¬ ì›í•˜ëŠ” ë©”ì„œë“œ í˜¸ì¶œì„ ê°€ë¡œì±„ê³  ì¡°ì‘í•œë‹¤.
- **ì¥ì **: ì¸í„°í˜ì´ìŠ¤ ì—†ì´ë„ í”„ë¡ì‹œë¥¼ ìƒì„±í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ìœ ì—°í•˜ë‹¤. ë˜í•œ ì„±ëŠ¥ì´ ì¢‹ë‹¤ëŠ” ê²ƒìœ¼ë¡œ ì•Œë ¤ì ¸ ìˆë‹¤.
- **ë‹¨ì **: ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë¯€ë¡œ ë³„ë„ì˜ ì˜ì¡´ì„±ì„ ì¶”ê°€í•´ì•¼ í•œë‹¤.

## **JDK Dynamic Proxy vs CGLib**

- **When to Use**:
    - JDK Dynamic ProxyëŠ” ëŒ€ìƒ ê°ì²´ê°€ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•  ë•Œ ì£¼ë¡œ ì‚¬ìš©ëœë‹¤.
    - CGLibëŠ” ëŒ€ìƒ ê°ì²´ê°€ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ì§€ ì•Šì„ ë•Œë‚˜, í´ë˜ìŠ¤ ê¸°ë°˜ì˜ í”„ë¡ì‹œê°€ í•„ìš”í•  ë•Œ ì‚¬ìš©ëœë‹¤.
- **Performance**: CGLibëŠ” ì¼ë°˜ì ìœ¼ë¡œ JDK Dynamic Proxyë³´ë‹¤ ë¹ ë¥´ë‹¤ê³  ì•Œë ¤ì ¸ ìˆë‹¤. ì´ëŠ” CGLibê°€ ë°”ì´íŠ¸ ì½”ë“œ ì¡°ì‘ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì´ë‹¤.
- **Integration with Frameworks**: ë§ì€ Java í”„ë ˆì„ì›Œí¬, íŠ¹íˆ Spring,ì€ ë‘ ê°€ì§€ ë°©ë²• ëª¨ë‘ë¥¼ ì§€ì›í•œë‹¤. ì‚¬ìš©ìëŠ” íŠ¹ì • ìƒí™©ì— ë”°ë¼ ì ì ˆí•œ ë°©ë²•ì„ ì„ íƒí•  ìˆ˜ ìˆë‹¤.

JDK Dynamic Proxyì™€ CGLibëŠ” ëª¨ë‘ Javaì—ì„œ AOPë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•œ ê°•ë ¥í•œ ë„êµ¬ì´ë‹¤. ê°ê°ì˜ ì¥ë‹¨ì ì´ ìˆìœ¼ë¯€ë¡œ ê°œë°œìëŠ” ì‚¬ìš© ì‚¬ë¡€ì— ë”°ë¼ ì ì ˆí•œ ë°©ë²•ì„ ì„ íƒí•´ì•¼ í•œë‹¤.

Dynamic Proxyì™€ CGLibì€ ëª¨ë‘ ëŸ°íƒ€ì„ ìœ„ë¹™ ë°©ì‹ì´ë©°Â **í”„ë¡ì‹œ íŒ¨í„´**ìœ¼ë¡œ ë™ì‘í•œë‹¤. ë”°ë¼ì„œ ë©”ì„œë“œ ì‹¤í–‰ ì‹œì—ë§Œ ìœ„ë¹™ì´ ê°€ëŠ¥í•˜ë‹¤. ê·¸ë˜ì„œ Dynamic Proxyì™€ CGLibë¥¼ ì‚¬ìš©í•˜ëŠ” ìŠ¤í”„ë§ AOPë„ ë©”ì„œë“œ ì‹¤í–‰ ì¡°ì¸í¬ì¸íŠ¸ë§Œ ì§€ì›í•œë‹¤. 

<aside>
```
ğŸ’¡ ìœ„ë¹™(Weaving)ì€ Aspect-Oriented Programming (AOP)ì—ì„œ ì¤‘ìš”í•œ ê°œë… ì¤‘ í•˜ë‚˜ì´ë‹¤.

AOPëŠ” í”„ë¡œê·¸ë˜ë°ì—ì„œ ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬ë¥¼ ì´‰ì§„í•˜ê¸° ìœ„í•œ íŒ¨ëŸ¬ë‹¤ì„ì´ë‹¤. ì—¬ê¸°ì„œ "ê´€ì‹¬ì‚¬"ë€ ë¡œê¹…, íŠ¸ëœì­ì…˜ ê´€ë¦¬, ë³´ì•ˆ ë“±ê³¼ ê°™ì´ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ëŠ” ì§ì ‘ì ì¸ ê´€ë ¨ì´ ì—†ì§€ë§Œ ì‹œìŠ¤í…œ ì „ì²´ì— ê±¸ì³ í•„ìš”í•œ ê¸°ëŠ¥ì„ ì˜ë¯¸í•œë‹¤. ì´ëŸ¬í•œ ê´€ì‹¬ì‚¬ë“¤ì€ ì¢…ì¢… ì—¬ëŸ¬ ëª¨ë“ˆì´ë‚˜ í´ë˜ìŠ¤ì— ê±¸ì³ ì¤‘ë³µë˜ì–´ êµ¬í˜„ë  ìˆ˜ ìˆë‹¤.

AOPëŠ” ì´ëŸ¬í•œ ê´€ì‹¬ì‚¬ë¥¼ ë³„ë„ì˜ ëª¨ë“ˆ(Aspectë¼ê³  ë¶€ë¦„)ë¡œ ë¶„ë¦¬í•˜ê³ , ì›ë˜ì˜ ì½”ë“œì— ì˜í–¥ì„ ì£¼ì§€ ì•Šê³  í•„ìš”í•œ ì‹œì ì— ì ì ˆí•˜ê²Œ ì‚½ì…í•˜ì—¬ ì‹¤í–‰ë˜ê²Œ í•œë‹¤. ì´ë ‡ê²Œ Aspectë¥¼ íŠ¹ì • ì§€ì ì— ì‚½ì…í•˜ëŠ” ê³¼ì •ì„ "ìœ„ë¹™"ì´ë¼ê³  ë¶€ë¥¸ë‹¤.

ìœ„ë¹™ì—ëŠ” ì—¬ëŸ¬ ë‹¨ê³„ì™€ ë°©ë²•ì´ ìˆì„ ìˆ˜ ìˆë‹¤:

1. **ì»´íŒŒì¼ ì‹œê°„ ìœ„ë¹™ (Compile-time Weaving)**: ì†ŒìŠ¤ ì½”ë“œê°€ ì»´íŒŒì¼ë  ë•Œ Aspectê°€ ë°”ì´íŠ¸ì½”ë“œì— ì‚½ì…ëœë‹¤.
2. **í´ë˜ìŠ¤ ë¡œë“œ ì‹œê°„ ìœ„ë¹™ (Load-time Weaving)**: í´ë˜ìŠ¤ê°€ JVMì— ë¡œë“œë  ë•Œ Aspectê°€ ë°”ì´íŠ¸ì½”ë“œì— ì‚½ì…ëœë‹¤.
3. **ëŸ°íƒ€ì„ ìœ„ë¹™ (Runtime Weaving)**: ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ ì¤‘ì¼ ë•Œ Aspectê°€ ê°ì²´ì— ì ìš©ëœë‹¤.

ì´ëŸ¬í•œ ìœ„ë¹™ì„ í†µí•´, ê°œë°œìëŠ” í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ì„œ ë¶€ìˆ˜ì ì¸ ì½”ë“œ(ì˜ˆ: ë¡œê¹…, íŠ¸ëœì­ì…˜ ê´€ë¦¬)ë¥¼ ë¶„ë¦¬í•˜ì—¬ ì½”ë“œì˜ ì¬ì‚¬ìš©ì„±ê³¼ ìœ ì§€ ë³´ìˆ˜ì„±ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆë‹¤.
```
</aside>****
